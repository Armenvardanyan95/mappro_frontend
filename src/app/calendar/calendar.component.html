<mat-sidenav-container>
  <div class="left-part">
    <p-calendar dateFormat="mm/dd/yy" [(ngModel)]="dateRange" inline="true" selectOtherMonths="true" selectionMode="range"
                (onSelect)="selectedDate()" [locale]="en"></p-calendar>
    <mat-list>
      <h4>Users</h4>
      <mat-list-item *ngFor="let user of users">
        <mat-checkbox [value]="user.id" [(ngModel)]="user.isSelected" (change)="selectUsers()">
          {{ user.firstName }} {{ user.lastName }}
        </mat-checkbox>
      </mat-list-item>
    </mat-list>

    <mat-list>
      <h4>Colors</h4>
      <mat-list-item *ngFor="let color of colors">
        <mat-checkbox [(ngModel)]="color.isSelected" (change)="selectUsers()">
          <span class="bordery" [style.border-color]="color.color">{{ color.name }}</span>
        </mat-checkbox>
      </mat-list-item>
    </mat-list>
  </div>

  <div [ngClass]="{'right-part': !selectedOrder, 'middle-part': selectedOrder}">
    <p-dataTable *ngIf="calendar && calendar.length" [value]="calendar" [style]="{overflow: 'visible'}">
      <p-column field="time" header="Time" [style]="{'width': '53px'}">
        <ng-template pTemplate let-day="rowData">
          <div style="font-size: 12px !important;">{{ day.time.time }}<sup>{{day.time.type}}</sup></div>
        </ng-template>
      </p-column>

      <p-column *ngFor="let d of days; let i=index" [field]="d" [header]="dayNames[i] + ' ' + d" [style]="{overflow: 'visible'}">
        <ng-template pTemplate let-day="rowData">
          <ng-container *ngFor="let order of day[d].orders">
            <div class="order-cell" (contextmenu)="selectOrder(order, $event)" (click)="details.toggle($event)"
                 [style.background]="makeRGBWithAlpha(order.colorMarkerDetails.color)" [style.border-color]="order.colorMarkerDetails.color">
              <strong class="wrap" style="font-weight: bolder">{{order.rank }}<br/> {{ order.name }}
                <mat-icon style="cursor: pointer;  position: absolute; right: 0;font-size: 18px; width: 16px; top: -2px" (click)="deleteOrder($event, order)" title="Delete">close</mat-icon>
              </strong>
            </div>
            <p-overlayPanel #details appendTo="body" [style]="{border: '4px solid ' + order.colorMarkerDetails.color, 'max-width': '700px'}">
              <p-header>
                <div style="text-align: center" class="noselect">
                  <button pButton icon="fa-check" *ngIf="order.isArchived" class="archived-button noselect" (click)="dearchiveOrder(order)"></button>
                  <button pButton icon="fa-circle" *ngIf="!order.isArchived" class="charchived-button noselect" (click)="archiveOrder(order)"></button>
                </div>
                <strong>{{ order.rank }} <br/> {{ order.name }}</strong>
              </p-header>
              <div class="comment-order" *ngIf="order.mobilePhone">
                <mat-icon>phone</mat-icon> {{ order.mobilePhones.join(', ') }}
              </div>
              <div class="comment-order" *ngIf="order.problem">
                <mat-icon>warning</mat-icon>
                {{ order.problem }}
              </div>
              <div class="comment-order" *ngIf="order.date || order.timeFrom || order.timeTo">
                <mat-icon>update</mat-icon>
                {{ order.date | date }} {{ order.timeFrom ? order.timeFrom : '' }}{{ order.timeTo ? (' - ' + order.timeTo) : '' }}
              </div>
              <div class="comment-order">
                <mat-icon>person pin</mat-icon>
                {{ (order.userDetails && order.userDetails.firstName ?  order.userDetails.firstName: '' ) + ' ' + (order.userDetails && order.userDetails.lastName ?  order.userDetails.lastName: '' )}}
              </div>
              <div class="comment-order" *ngIf="order.comment">
                <mat-icon>comment</mat-icon>
                {{ order.comment }}
              </div>
              <br/>
              <p-dropdown class="marker-color-modal" placeholder="Marker Color" [options]="colors | map : mapColorsToSelectItem"
                         [(ngModel)]="order.colorMarkerDetails.id" [style]="{'width': '20%'}" (ngModelChange)="updateOrderColor(order)">
              </p-dropdown>
            </p-overlayPanel>
          </ng-container>
        </ng-template>
      </p-column>
    </p-dataTable>
  </div>

  <div *ngIf="selectedOrder" class="outer-right">
    <mat-icon style="cursor: pointer" (click)="selectedOrder = null">close</mat-icon>
    <app-order-edit [order]="selectedOrder" [colors]="colors" [users]="users" (orderUpdated)="searchForOrders(); selectedOrder = null"></app-order-edit>
  </div>

  <button mat-raised-button *ngIf="!sidenav.opened" type="button" (click)="sidenav.open()" class="hide-button">
    <mat-icon>keyboard_arrow_left</mat-icon>
  </button>
  <div *ngIf="doFilterOrders" class="most-right">
    <mat-list class="scrollable-2">

    </mat-list>
  </div>

  <mat-sidenav #sidenav class="example-sidenav" mode="side" position="end" align="end">
    <mat-icon style="cursor: pointer; font-size: 18px;" (click)="sidenav.close()">close</mat-icon>
    <button mat-raised-button (click)="deleteMultipleOrders()">Delete by date</button>
    <button mat-raised-button (click)="enableArchiveModeOrDelete()" *ngIf="orders && orders.length">Delete</button>
    <button mat-raised-button (click)="filterOrdersWithoutDate()">No Date</button>
    <div>
      <!--<form autocomplete="off">-->
        <div *ngIf="archiveMode && orders && orders.length">
          <mat-checkbox [(ngModel)]="allSelected" (change)="selectAll()">Select All</mat-checkbox>
          <mat-checkbox [(ngModel)]="selectFromMode" (change)="selectFromModeOn()">Select From</mat-checkbox>
          <mat-checkbox [(ngModel)]="selectToMode" (change)="selectToModeOn()">Select To</mat-checkbox>
        </div>
      <div style="width: 90px;
    float: left;
    text-align: center;">
        <p-multiSelect defaultLabel="Color" [options]="colorItems" [(ngModel)]="search.colors" (ngModelChange)="massFilterOrders()">
        </p-multiSelect>
        </div>
        <div style="min-width: 100%; margin-top: 10px">
          <p-calendar showIcon="true" dateFormat="mm/dd/yy" [(ngModel)]="search.date" (ngModelChange)="massFilterOrders()"></p-calendar>
        </div>
        <div>
          <mat-input-container>
            <input matInput placeholder="Search" [(ngModel)]="search.search" (ngModelChange)="massFilterOrders()"/>
          </mat-input-container>
        </div>
      <!--</form>-->
    </div>

    <ng-container *ngFor="let order of orders; let i=index">
      <app-order-view [index]="order.rank" [order]="order" (orderMadeVisible)="changeOrderVisibility(order)"
                      [archiveMode]="archiveMode" (orderSelected)="orderHasBeenSelected(i)"
                      [colors]="colors" [users]="users"></app-order-view>
    </ng-container>
  </mat-sidenav>

</mat-sidenav-container>
